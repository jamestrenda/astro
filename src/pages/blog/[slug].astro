---
import { getPosts, getPost } from "../../utils/sanity";
import type { InferGetStaticParamsType } from "astro";
import PortableText from "~/components/PortableText/PortableText.astro";
import Layout from "../_layout.astro";
import Heading from "~/components/Heading.astro";

export async function getStaticPaths() {
  const posts = await getPosts({
    preview: false,
  });
  return posts.map((post) => ({
    params: { slug: post.slug.current },
  }));
}

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
const { slug } = Astro.params as Params;

const post = await getPost({
  preview: Astro.locals.preview,
  options: Astro.locals.loadQueryOptions,
  slug,
});

// No product found
if (!post) {
  return new Response(null, {
    status: 404,
    statusText: "Post Not found",
  });
}

const { title, body } = post;
---

<Layout>
  <article>
    <Heading as="h1">{title}</Heading>
    {body ? <PortableText value={body} /> : null}
  </article>
</Layout>
